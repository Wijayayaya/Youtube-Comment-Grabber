{% extends "admin/base_admin.html" %}
{% load static %}

{% block title %}Change Password - YouTube Comment Grabber{% endblock %}

{% block content %}
<!-- [ breadcrumb ] start -->
<div class="page-header">
  <div class="page-block">
    <div class="row align-items-center">
      <div class="col-md-12">
        <div class="page-header-title">
          <h5 class="mb-0">Change Password</h5>
        </div>
      </div>
      <div class="col-md-12">
        <ul class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="{% url 'comments:admin-dashboard' %}">Home</a></li>
          <li class="breadcrumb-item"><a href="{% url 'comments:admin-profile' %}">Profile</a></li>
          <li class="breadcrumb-item" aria-current="page">Change Password</li>
        </ul>
      </div>
    </div>
  </div>
</div>
<!-- [ breadcrumb ] end -->

<div class="row justify-content-center">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5>Change Password</h5>
        <small class="text-muted">Update your account password</small>
      </div>
      <div class="card-body">
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              <i data-feather="{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}x-circle{% else %}info{% endif %}"></i>
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
        
        <form method="post">
          {% csrf_token %}
          
          <div class="mb-3">
            <label for="old_password" class="form-label">Current Password</label>
            <div class="input-group">
              <input type="password" class="form-control" id="old_password" name="old_password" 
                     placeholder="Enter current password" required>
              <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('old_password')">
                <i data-feather="eye" id="old_password_icon"></i>
              </button>
            </div>
            <small class="form-text text-muted">Enter your current password for verification</small>
          </div>
          
          <div class="mb-3">
            <label for="new_password1" class="form-label">New Password</label>
            <div class="input-group">
              <input type="password" class="form-control" id="new_password1" name="new_password1" 
                     placeholder="Enter new password" required minlength="8">
              <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password1')">
                <i data-feather="eye" id="new_password1_icon"></i>
              </button>
            </div>
            <small class="form-text text-muted">Password minimal 8 karakter</small>
          </div>
          
          <div class="mb-3">
            <label for="new_password2" class="form-label">Confirm New Password</label>
            <div class="input-group">
              <input type="password" class="form-control" id="new_password2" name="new_password2" 
                     placeholder="Confirm new password" required minlength="8">
              <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password2')">
                <i data-feather="eye" id="new_password2_icon"></i>
              </button>
            </div>
            <small class="form-text text-muted">Re-enter your new password</small>
          </div>
          
          <!-- Password Strength Indicator -->
          <div class="mb-3">
            <label class="form-label">Password Strength</label>
            <div class="progress" style="height: 5px;">
              <div class="progress-bar" id="password-strength-bar" role="progressbar" style="width: 0%"></div>
            </div>
            <small id="password-strength-text" class="form-text text-muted">Enter a password to see strength</small>
          </div>
          
          <div class="alert alert-info" role="alert">
            <i data-feather="info"></i>
            <strong>Password Requirements:</strong>
            <ul class="mb-0 mt-2">
              <li>Minimal 8 karakter</li>
            </ul>
          </div>
          
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">
              <i data-feather="key"></i> Change Password
            </button>
            <a href="{% url 'comments:admin-profile' %}" class="btn btn-secondary">
              <i data-feather="arrow-left"></i> Back to Profile
            </a>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Security Tips -->
    <div class="card">
      <div class="card-header">
        <h5>Security Tips</h5>
      </div>
      <div class="card-body">
        <div class="d-flex align-items-start mb-3">
          <div class="flex-shrink-0">
            <i data-feather="shield" class="text-success" style="width: 24px; height: 24px;"></i>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="mb-0"><strong>Use a strong password</strong></p>
            <small class="text-muted">Combine letters, numbers, and special characters</small>
          </div>
        </div>
        
        <div class="d-flex align-items-start mb-3">
          <div class="flex-shrink-0">
            <i data-feather="refresh-cw" class="text-info" style="width: 24px; height: 24px;"></i>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="mb-0"><strong>Change regularly</strong></p>
            <small class="text-muted">Update your password every few months</small>
          </div>
        </div>
        
        <div class="d-flex align-items-start">
          <div class="flex-shrink-0">
            <i data-feather="lock" class="text-warning" style="width: 24px; height: 24px;"></i>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="mb-0"><strong>Keep it private</strong></p>
            <small class="text-muted">Never share your password with anyone</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Toggle password visibility
function togglePassword(fieldId) {
  const field = document.getElementById(fieldId);
  const icon = document.getElementById(fieldId + '_icon');
  
  if (field.type === 'password') {
    field.type = 'text';
    icon.setAttribute('data-feather', 'eye-off');
  } else {
    field.type = 'password';
    icon.setAttribute('data-feather', 'eye');
  }
  
  // Re-initialize feather icons
  feather.replace();
}

// Password strength checker
document.getElementById('new_password1').addEventListener('input', function() {
  const password = this.value;
  const strengthBar = document.getElementById('password-strength-bar');
  const strengthText = document.getElementById('password-strength-text');
  
  let strength = 0;
  let text = '';
  let color = '';
  
  // Only check password length
  if (password.length === 0) {
    text = 'Masukkan password untuk melihat kekuatan';
    color = '';
    strength = 0;
  } else if (password.length < 8) {
    text = 'Password terlalu pendek (minimal 8 karakter)';
    color = 'bg-danger';
    strength = (password.length / 8) * 100;
  } else {
    text = 'Password memenuhi syarat';
    color = 'bg-success';
    strength = 100;
  }
  
  strengthBar.style.width = strength + '%';
  strengthBar.className = 'progress-bar ' + color;
  strengthText.textContent = text;
  strengthText.className = 'form-text ' + (color.replace('bg-', 'text-') || 'text-muted');
});

// Confirm password match validation
document.getElementById('new_password2').addEventListener('input', function() {
  const password1 = document.getElementById('new_password1').value;
  const password2 = this.value;
  
  if (password2 && password1 !== password2) {
    this.setCustomValidity('Passwords do not match');
  } else {
    this.setCustomValidity('');
  }
});
</script>

{% endblock %}
